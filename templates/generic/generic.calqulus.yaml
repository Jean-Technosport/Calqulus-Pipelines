############
## SPACES ##
############

- space: VirtualLab
  alignWithSegment:
    segment: Hips

############
## EVENTS ##
############

- event: BOF
  steps:
    - import: [0]

- event: EOF
  steps:
    - subtract: [$length, 1]

# it is assumed that LON,LOFF,RON,ROFF were manually entered in QTM

# Unified event names for web
- event: LeftPlotStart
  steps:
    - if: LON
      then: LON
      else: BOF

- event: LeftPlotEnd
  steps:
    - if: LOFF
      then: LOFF
      else: EOF

- event: RightPlotStart
  steps:
    - if: RON
      then: RON
      else: BOF

- event: RightPlotEnd
  steps:
    - if: ROFF
      then: ROFF
      else: EOF

############
## SERIES ##
############

- template: /templates/timeseries.calqulus.yaml

# Following pelvis and thorax are required by layout
# --- Pelvis ---

- parameter: Pelvic Angles
  where:
    name: '!Static*'
  steps:
    - angle: Hips # angle is calculated relative to axes of global coordinate system, if only single input exists
      space: VirtualLab # calculate angle relative to virtual lab
    - multiply: [$prev, [-1, 1, 1]] # invert first component of output

# --- Thorax ---

- parameter: Thorax Angles
  where:
    name: '!Static*'
  steps:
    - angle: [Hips, Spine2]
    - multiply: [$prev, [-1, -1, 1]]

#############
## Metrics ##
#############

# Find global maximum/minimum/mean

# Left ----
# Pelvis
- parameter: Left Pelvic Angles_max
  set: left
  steps:
    - eventMask: [Left Pelvic Angles, LON, LOFF]
    - max: 

- parameter: Left Pelvic Angles_min
  set: left
  steps:
    - eventMask: [Left Pelvic Angles, LON, LOFF]
    - min: 

- parameter: Left Pelvic Angles_mean
  set: left
  steps:
    - eventMask: [Left Pelvic Angles, LON, LOFF]
    - mean: 

# Hips
- parameter: Left Hip Angles_max
  set: left
  steps:
    - eventMask: [Left Hip Angles, LON, LOFF]
    - max: 

- parameter: Left Hip Angles_min
  set: left
  steps:
    - eventMask: [Left Hip Angles, LON, LOFF]
    - min: 

- parameter: Left Hip Angles_mean
  set: left
  steps:
    - eventMask: [Left Hip Angles, LON, LOFF]
    - mean: 

# Knees
- parameter: Left Knee Angles_max
  set: left
  steps:
    - eventMask: [Left Knee Angles, LON, LOFF]
    - max: 

- parameter: Left Knee Angles_min
  set: left
  steps:
    - eventMask: [Left Knee Angles, LON, LOFF]
    - min: 

- parameter: Left Knee Angles_mean
  set: left
  steps:
    - eventMask: [Left Knee Angles, LON, LOFF]
    - mean: 

# Ankles
- parameter: Left Ankle Angles_max
  set: left
  steps:
    - eventMask: [Left Ankle Angles, LON, LOFF]
    - max: 

- parameter: Left Ankle Angles_min
  set: left
  steps:
    - eventMask: [Left Ankle Angles, LON, LOFF]
    - min: 

- parameter: Left Ankle Angles_mean
  set: left
  steps:
    - eventMask: [Left Ankle Angles, LON, LOFF]
    - mean: 

# Feet
- parameter: Left Foot Pitch Angles_max
  set: left
  steps:
    - eventMask: [Left Foot Pitch Angles, LON, LOFF]
    - max: 

- parameter: Left Foot Pitch Angles_min
  set: left
  steps:
    - eventMask: [Left Foot Pitch Angles, LON, LOFF]
    - min: 

- parameter: Left Foot Pitch Angles_mean
  set: left
  steps:
    - eventMask: [Left Foot Pitch Angles, LON, LOFF]
    - mean: 

# Copy of previous signal for compatibility with report layout
- parameter: Left Foot Progression_max
  set: left
  steps:
    - import: Left Foot Pitch Angles_max

- parameter: Left Foot Progression_min
  set: left
  steps:
    - import: Left Foot Pitch Angles_min

- parameter: Left Foot Progression_mean
  set: left
  steps:
    - import: Left Foot Pitch Angles_mean

# Shoulders
- parameter: Left Shoulder Angles_max
  set: left
  steps:
    - eventMask: [Left Shoulder Angles, LON, LOFF]
    - max: 

- parameter: Left Shoulder Angles_min
  set: left
  steps:
    - eventMask: [Left Shoulder Angles, LON, LOFF]
    - min: 

- parameter: Left Shoulder Angles_mean
  set: left
  steps:
    - eventMask: [Left Shoulder Angles, LON, LOFF]
    - mean: 

- parameter: Left Shoulder Ang Vel_max
  set: left
  steps:
    - eventMask: [Left Shoulder Ang Vel, LON, LOFF]
    - max: 

- parameter: Left Shoulder Ang Vel_min
  set: left
  steps:
    - eventMask: [Left Shoulder Ang Vel, LON, LOFF]
    - min: 

- parameter: Left Shoulder Ang Vel_mean
  set: left
  steps:
    - eventMask: [Left Shoulder Ang Vel, LON, LOFF]
    - mean: 

# Elbows
- parameter: Left Elbow Angles_max
  set: left
  steps:
    - eventMask: [Left Elbow Angles, LON, LOFF]
    - max: 

- parameter: Left Elbow Angles_min
  set: left
  steps:
    - eventMask: [Left Elbow Angles, LON, LOFF]
    - min: 

- parameter: Left Elbow Angles_mean
  set: left
  steps:
    - eventMask: [Left Elbow Angles, LON, LOFF]
    - mean: 

# Wrists
- parameter: Left Wrist Angles_max
  set: left
  steps:
    - eventMask: [Left Wrist Angles, LON, LOFF]
    - max: 

- parameter: Left Wrist Angles_min
  set: left
  steps:
    - eventMask: [Left Wrist Angles, LON, LOFF]
    - min: 

- parameter: Left Wrist Angles_mean
  set: left
  steps:
    - eventMask: [Left Wrist Angles, LON, LOFF]
    - mean: 

# Thorax
- parameter: Left Thorax Angles_max
  set: left
  steps:
    - eventMask: [Left Thorax Angles, LON, LOFF]
    - max: 

- parameter: Left Thorax Angles_min
  set: left
  steps:
    - eventMask: [Left Thorax Angles, LON, LOFF]
    - min: 

- parameter: Left Thorax Angles_mean
  set: left
  steps:
    - eventMask: [Left Thorax Angles, LON, LOFF]
    - mean: 

- parameter: Left Thorax_Lab Angles_max
  set: left
  steps:
    - eventMask: [Left Thorax_Lab Angles, LON, LOFF]
    - max: 

- parameter: Left Thorax_Lab Angles_min
  set: left
  steps:
    - eventMask: [Left Thorax_Lab Angles, LON, LOFF]
    - min: 

- parameter: Left Thorax_Lab Angles_mean
  set: left
  steps:
    - eventMask: [Left Thorax_Lab Angles, LON, LOFF]
    - mean: 

# Right ---
# Pelvis
- parameter: Right Pelvic Angles_max
  set: right
  steps:
    - eventMask: [Right Pelvic Angles, RON, ROFF]
    - max: 

- parameter: Right Pelvic Angles_min
  set: right
  steps:
    - eventMask: [Right Pelvic Angles, RON, ROFF]
    - min: 

- parameter: Right Pelvic Angles_mean
  set: right
  steps:
    - eventMask: [Right Pelvic Angles, RON, ROFF]
    - mean: 

# Hips
- parameter: Right Hip Angles_max
  set: right
  steps:
    - eventMask: [Right Hip Angles, RON, ROFF]
    - max: 

- parameter: Right Hip Angles_min
  set: right
  steps:
    - eventMask: [Right Hip Angles, RON, ROFF]
    - min: 

- parameter: Right Hip Angles_mean
  set: right
  steps:
    - eventMask: [Right Hip Angles, RON, ROFF]
    - mean: 

# Knees
- parameter: Right Knee Angles_max
  set: right
  steps:
    - eventMask: [Right Knee Angles, RON, ROFF]
    - max: 

- parameter: Right Knee Angles_min
  set: right
  steps:
    - eventMask: [Right Knee Angles, RON, ROFF]
    - min: 

- parameter: Right Knee Angles_mean
  set: right
  steps:
    - eventMask: [Right Knee Angles, RON, ROFF]
    - mean: 

# Ankles
- parameter: Right Ankle Angles_max
  set: right
  steps:
    - eventMask: [Right Ankle Angles, RON, ROFF]
    - max: 

- parameter: Right Ankle Angles_min
  set: right
  steps:
    - eventMask: [Right Ankle Angles, RON, ROFF]
    - min: 

- parameter: Right Ankle Angles_mean
  set: right
  steps:
    - eventMask: [Right Ankle Angles, RON, ROFF]
    - mean: 

# Feet
- parameter: Right Foot Pitch Angles_max
  set: right
  steps:
    - eventMask: [Right Foot Pitch Angles, RON, ROFF]
    - max: 

- parameter: Right Foot Pitch Angles_min
  set: right
  steps:
    - eventMask: [Right Foot Pitch Angles, RON, ROFF]
    - min: 

- parameter: Right Foot Pitch Angles_mean
  set: right
  steps:
    - eventMask: [Right Foot Pitch Angles, RON, ROFF]
    - mean: 

# Copy of previous signal for compatibility with report layout
- parameter: Right Foot Progression_max
  set: right
  steps:
    - import: Right Foot Pitch Angles_max

- parameter: Right Foot Progression_min
  set: right
  steps:
    - import: Right Foot Pitch Angles_min

- parameter: Right Foot Progression_mean
  set: right
  steps:
    - import: Right Foot Pitch Angles_mean

# Shoulders
- parameter: Right Shoulder Angles_max
  set: right
  steps:
    - eventMask: [Right Shoulder Angles, RON, ROFF]
    - max: 

- parameter: Right Shoulder Angles_min
  set: right
  steps:
    - eventMask: [Right Shoulder Angles, RON, ROFF]
    - min: 

- parameter: Right Shoulder Angles_mean
  set: right
  steps:
    - eventMask: [Right Shoulder Angles, RON, ROFF]
    - mean: 

- parameter: Right Shoulder Ang Vel_max
  set: right
  steps:
    - eventMask: [Right Shoulder Ang Vel, RON, ROFF]
    - max: 

- parameter: Right Shoulder Ang Vel_min
  set: right
  steps:
    - eventMask: [Right Shoulder Ang Vel, RON, ROFF]
    - min: 

- parameter: Right Shoulder Ang Vel_mean
  set: right
  steps:
    - eventMask: [Right Shoulder Ang Vel, RON, ROFF]
    - mean: 

# Elbows
- parameter: Right Elbow Angles_max
  set: right
  steps:
    - eventMask: [Right Elbow Angles, RON, ROFF]
    - max: 

- parameter: Right Elbow Angles_min
  set: right
  steps:
    - eventMask: [Right Elbow Angles, RON, ROFF]
    - min: 

- parameter: Right Elbow Angles_mean
  set: right
  steps:
    - eventMask: [Right Elbow Angles, RON, ROFF]
    - mean: 

# Wrists
- parameter: Right Wrist Angles_max
  set: right
  steps:
    - eventMask: [Right Wrist Angles, RON, ROFF]
    - max: 

- parameter: Right Wrist Angles_min
  set: right
  steps:
    - eventMask: [Right Wrist Angles, RON, ROFF]
    - min: 

- parameter: Right Wrist Angles_mean
  set: right
  steps:
    - eventMask: [Right Wrist Angles, RON, ROFF]
    - mean: 

# Thorax
- parameter: Right Thorax Angles_max
  set: right
  steps:
    - eventMask: [Right Thorax Angles, RON, ROFF]
    - max: 

- parameter: Right Thorax Angles_min
  set: right
  steps:
    - eventMask: [Right Thorax Angles, RON, ROFF]
    - min: 

- parameter: Right Thorax Angles_mean
  set: right
  steps:
    - eventMask: [Right Thorax Angles, RON, ROFF]
    - mean:

- parameter: Right Thorax_Lab Angles_max
  set: right
  steps:
    - eventMask: [Right Thorax_Lab Angles, RON, ROFF]
    - max: 

- parameter: Right Thorax_Lab Angles_min
  set: right
  steps:
    - eventMask: [Right Thorax_Lab Angles, RON, ROFF]
    - min: 

- parameter: Right Thorax_Lab Angles_mean
  set: right
  steps:
    - eventMask: [Right Thorax_Lab Angles, RON, ROFF]
    - mean:

